@{
    ViewData["Title"] = "Ch·ªçn Gh·∫ø";
    
    // L·∫•y d·ªØ li·ªáu t·ª´ ViewBag ƒë∆∞·ª£c truy·ªÅn t·ª´ Controller
    var showTime = (CinemaBooking.Models.ShowTime)ViewBag.ShowTime;
    var seats = (List<CinemaBooking.Models.Seat>)ViewBag.Seats;
    var bookedSeatIds = (List<int>)ViewBag.BookedSeatIds;
}

<div class="container mt-5">
    <h2>üé¨ Ch·ªçn Gh·∫ø - @showTime.Movie.Title</h2>
    
    <!-- Hi·ªÉn th·ªã th√¥ng tin su·∫•t chi·∫øu -->
    <div style="background-color: #f0f0f0; padding: 15px; margin: 15px 0; border-radius: 5px;">
        <p><strong>üè¢ R·∫°p:</strong> @showTime.Cinema.Name</p>
        <p><strong>‚è∞ Gi·ªù chi·∫øu:</strong> @showTime.TimeSlot.ToString("dd/MM/yyyy HH:mm")</p>
    </div>

    <!-- Form g·ª≠i d·ªØ li·ªáu POST t·ªõi action Confirm -->
    <form method="post" action="/Bookings/Confirm">
        <!-- Hidden input: g·ª≠i ShowTimeId t·ªõi Controller -->
        <input type="hidden" name="showTimeId" value="@showTime.Id" />

        <div style="margin: 30px 0;">
            <h4>üìã S∆° ƒë·ªì gh·∫ø:</h4>
            <p style="color: gray;">Ch·ªçn gh·∫ø b·∫±ng c√°ch b·∫•m v√†o n√≥ (xanh = tr·ªëng, ƒë·ªè = ƒë√£ ƒë·∫∑t)</p>
            
            @{
                // Nh√≥m gh·∫ø theo h√†ng (A, B, C, D, ...)
                // GroupBy() t√°ch gh·∫ø theo k√Ω t·ª± ƒë·∫ßu (A t·ª´ A1, A2, A3, etc)
                // OrderBy() s·∫Øp x·∫øp theo t√™n h√†ng (A, B, C, ...)
                var grouped = seats.GroupBy(s => s.SeatNumber[0]).OrderBy(g => g.Key);
            }

            <!-- Hi·ªÉn th·ªã t·ª´ng h√†ng gh·∫ø -->
            @foreach (var row in grouped)
            {
                <div style="margin: 15px 0;">
                    <!-- T√™n h√†ng (A, B, C, ...) -->
                    <strong style="font-size: 18px;">@row.Key</strong>
                    
                    <!-- Hi·ªÉn th·ªã t·ª´ng gh·∫ø trong h√†ng -->
                    @foreach (var seat in row.OrderBy(s => s.SeatNumber))
                    {
                        // Ki·ªÉm tra gh·∫ø n√†y ƒë√£ ƒë∆∞·ª£c ƒë·∫∑t ch∆∞a
                        var isBooked = bookedSeatIds.Contains(seat.Id);
                        
                        <label style="margin-right: 8px; display: inline-block;">
                            <!-- Checkbox ƒë·ªÉ ch·ªçn gh·∫ø -->
                            <!-- N·∫øu gh·∫ø ƒë√£ ƒë·∫∑t (isBooked = true) th√¨ disable (kh√¥ng cho ch·ªçn) -->
                            <input type="checkbox" 
                                   name="seatIds" 
                                   value="@seat.Id"
                                   @(isBooked ? "disabled" : "") />
                            
                            <!-- Hi·ªÉn th·ªã s·ªë gh·∫ø v·ªõi m√†u kh√°c nhau -->
                            <!-- Gh·∫ø tr·ªëng: xanh, Gh·∫ø ƒë√£ ƒë·∫∑t: ƒë·ªè -->
                            <span style="padding: 8px 12px; 
                                         background-color: @(isBooked ? "red" : "lightgreen"); 
                                         color: @(isBooked ? "white" : "black");
                                         border-radius: 3px;
                                         cursor: @(isBooked ? "not-allowed" : "pointer");
                                         display: inline-block;
                                         min-width: 40px;
                                         text-align: center;">
                                @seat.SeatNumber
                            </span>
                        </label>
                    }
                </div>
            }
        </div>

        <!-- Ch√∫ th√≠ch m√†u s·∫Øc -->
        <div style="margin: 20px 0; padding: 15px; background-color: #ffffcc; border-radius: 5px;">
            <h5>Ch√∫ th√≠ch:</h5>
            <span style="background-color: lightgreen; padding: 5px 10px; margin-right: 15px; border-radius: 3px;">
                ‚úì Gh·∫ø tr·ªëng (c√≥ th·ªÉ ch·ªçn)
            </span>
            <span style="background-color: red; color: white; padding: 5px 10px; border-radius: 3px;">
                ‚úó Gh·∫ø ƒë√£ ƒë·∫∑t (kh√¥ng ch·ªçn ƒë∆∞·ª£c)
            </span>
        </div>

        <!-- Button x√°c nh·∫≠n -->
        <div style="margin: 20px 0;">
            <button type="submit" class="btn btn-success" style="padding: 10px 20px; font-size: 16px;">
                üí≥ X√°c Nh·∫≠n ƒê·∫∑t V√©
            </button>
            <a href="/Movies/Details/@showTime.MovieId" class="btn btn-secondary" style="padding: 10px 20px; font-size: 16px;">
                ‚Üê Quay L·∫°i
            </a>
        </div>
    </form>

    <!-- Hi·ªÉn th·ªã th√¥ng b√°o l·ªói n·∫øu c√≥ -->
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger">
            ‚ö†Ô∏è @TempData["Error"]
        </div>
    }
</div>