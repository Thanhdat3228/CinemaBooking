@model List<CinemaBooking.Models.Booking>

@{
    ViewData["Title"] = "V√© c·ªßa t√¥i";
}

<div class="container mt-5">
    <h2>üé´ V√© c·ªßa t√¥i</h2>

    <!-- N·∫øu danh s√°ch v√© tr·ªëng: hi·ªÉn th·ªã th√¥ng b√°o -->
    @if (Model.Count == 0)
    {
        <div class="alert alert-warning">
            <strong>B·∫°n ch∆∞a ƒë·∫∑t v√© n√†o.</strong> 
            <a href="/">Xem phim ngay</a>
        </div>
    }
    else
    {
        <!-- B·∫£ng hi·ªÉn th·ªã danh s√°ch v√© -->
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>üé¨ Phim</th>           <!-- T√™n phim -->
                    <th>ü™ë Gh·∫ø</th>             <!-- S·ªë gh·∫ø -->
                    <th>‚è∞ Gi·ªù chi·∫øu</th>        <!-- Th·ªùi gian chi·∫øu -->
                    <th>‚öôÔ∏è H√†nh ƒë·ªông</th>       <!-- Button h·ªßy v√© -->
                </tr>
            </thead>
            <tbody>
                <!-- L·∫∑p qua t·ª´ng booking (v√©) -->
                @foreach (var booking in Model)
                {
                    <tr>
                        <!-- L·∫•y t√™n phim t·ª´ booking.ShowTime.Movie.Title -->
                        <td>@booking.ShowTime.Movie.Title</td>
                        
                        <!-- L·∫•y s·ªë gh·∫ø t·ª´ booking.Seat.SeatNumber -->
                        <td><strong>@booking.Seat.SeatNumber</strong></td>
                        
                        <!-- L·∫•y gi·ªù chi·∫øu v√† format ng√†y/gi·ªù -->
                        <td>@booking.ShowTime.TimeSlot.ToString("dd/MM/yyyy HH:mm")</td>
                        
                        <!-- Button h·ªßy v√© -->
                        <td>
                            <!-- Form POST g·ª≠i t·ªõi action CancelBooking -->
                            <form method="post" action="/Bookings/CancelBooking" style="display: inline;">
                                <!-- Hidden input: g·ª≠i ID v√© c·∫ßn h·ªßy -->
                                <input type="hidden" name="bookingId" value="@booking.Id" />
                                
                                <!-- Button h·ªßy v√© -->
                                <button type="submit" class="btn btn-sm btn-danger">
                                    ‚ùå H·ªßy v√©
                                </button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }

    <!-- Link quay v·ªÅ trang ch·ªß -->
    <a href="/" class="btn btn-secondary mt-3">üè† Quay v·ªÅ trang ch·ªß</a>
</div>

<!-- SweetAlert2 - Custom Dialog -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    // B·∫Øt s·ª± ki·ªán submit form
    document.querySelectorAll('form[action="/Bookings/CancelBooking"]').forEach(form => {
        form.addEventListener('submit', function(e) {
            e.preventDefault();  // D·ª´ng g·ª≠i form
            
            Swal.fire({
                title: 'X√°c nh·∫≠n h·ªßy v√©',
                text: 'B·∫°n ch·∫Øc ch·∫Øn mu·ªën h·ªßy v√© n√†y kh√¥ng?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#dc3545',  // M√†u ƒë·ªè
                cancelButtonColor: '#6c757d',   // M√†u x√°m
                confirmButtonText: 'H·ªßy v√©',
                cancelButtonText: 'Kh√¥ng'
            }).then((result) => {
                if (result.isConfirmed) {
                    form.submit();  // G·ª≠i form n·∫øu x√°c nh·∫≠n
                }
            });
        });
    });
</script>